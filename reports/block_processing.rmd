---
title: "Block Processing Report"
date: "`r Sys.Date()`"
params:
  HwInfo: (Hardware Info)
  OsInfo: (OS Info)
  Machine: (Machine Info)
  GoInfo: (GO Info)
  GitHash: (GithubKey)
  StateDB: (StateDB)
  VM: (VM)
  db: ./test.db
---

```{r, include = FALSE}
library(ggplot2)
library(dplyr)
library(RSQLite)
con <- dbConnect(SQLite(), params$db)
data <- dbReadTable(con, 'parallelprofile')
reducedData <- dbReadTable(con, 'aggregatedParallelProfile')
dbDisconnect(con)
```

## 1. Experiment
The experiment is run on the machine `r params$Machine`, which is a `r params$HwInfo` computer.
The operating system is `r params$OsInfo`.
The system has installed `r params$GoInfo`.
The github hash of the Aida repository is `r params$GitHash`.
For this experiment, we use **`r params$StateDB`** as a StateDB and **`r params$VM`** as a virtual machine.
The data set for this experiment is stored in the database `r params$db`.

The experiment was conducted for the block range from **`r format(min(data$block),big.mark=",")`**  to **`r format(max(data$block),big.mark=",")`**.

## 2. Block Processing Time

The average block execution time is `r mean(data$tBlock)/1e6` milliseconds with a minimum of `r min(data$tBlock)/1e3` microseconds and a maximum of `r max(data$tBlock)/1e9` seconds.
The smoothened trend line for block time (in milliseconds) is shown below. In the diagram, we aggregated the block time for all 100K blocks shown as points.

```{r, echo=FALSE, message=FALSE}
reducedData %>%
  ggplot(aes(x = block, y = tBlock)) +
  geom_smooth(color = "tomato") +
  geom_point(alpha=0.3) +
  labs(x="Block Height", y="Block Time (ms)", title="Sequential Block Time")
```

## 3. Commit Time

The average commit time is `r mean(data$tCommit)/1e6` milliseconds with a minimum of `r min(data$tCommit)/1e3` microseconds and a maximum of `r max(data$tCommit)/1e9` seconds.
The smoothened trend line of the commit time in milliseconds is shown below. In the diagram, we aggregated the commit time for all 100K blocks shown as points.

```{r, echo = FALSE, message=FALSE}
reducedData %>%
  ggplot(aes(x = block, y = tCommit)) +
  geom_smooth(color = "tomato") +
  geom_point(alpha=0.3) +
  labs(x="Block Height", y="Commit Time (ms)", title="Commit Time")
```


## 4. Block gas

The average gas consumption of a block is `r mean(data$gasBlock)` with a minimum of `r min(data$gasBlock)` and a maximum of `r max(data$gasBlock)`.
The smoothened trend line of the gas consumption is shown in the figure below. In the figure, we aggregate the gas consumption for all 100K blocks as points.

```{r, echo = FALSE, message=FALSE}
reducedData %>%
  ggplot(aes(x = block, y = gasBlock)) +
  geom_smooth(color = "tomato") +
  geom_point(alpha=0.3) +
  labs(x="Block Height", y="Block Gas", title="Gas Consumption of Blocks")
```

## 5. Number of Transactions per Block

We have, on average `r mean(data$numTx)` transactions per block.
The smallest number of transactions per block is `r min(data$numTx)`, and the largest number is `r max(data$numTx)`.
The distribution of number of transactions per block is shown below:

```{r, echo = FALSE, message=FALSE}
hist(data$numTx, freq=FALSE, main="Number of Transaction Distribution", xlab="Number of Transactions", col="lightblue1"); rug(data$numTx)
abline(v=mean(data$numTx), col="dodgerblue3", lty=2, lwd=2)
```

The smoothened trend line for the number of transaction is shown below. In this diagram, we aggregated the number
of transactions per block for 100K blocks shown as points.

```{r, echo=FALSE, message=FALSE}
reducedData %>%
  ggplot(aes(x = block, y = numTx)) +
  geom_smooth(color = "tomato") +
  geom_point(alpha=0.3) +
  labs(x="Block Height", y="Number of Transactions", title="Number of Transactions per Block")
```

